{"version":3,"sources":["components/model.class.js","index.js"],"names":["Model","container","mapboxgl","accessToken","map","Map","style","zoom","center","getUniqueFeatures","array","comparatorProperty","existingFeatureKeys","uniqueFeatures","filter","el","properties","nav","NavigationControl","addControl","on","addLayer","type","url","data1","feature","addSource","data","popup","Popup","closeButton","closeOnClick","zipcodes","features","queryRenderedFeatures","layers","document","getElementById","innerHTML","filtered","zipcode","ZIP_Code","indexOf","forEach","f","String","fetch","mode","then","resp","json","notifications","length","location","value","description","messages","message","geometry","coordinates","push","getSource","setData","setLngLat","setHTML","addTo","openNav","width","marginLeft","closeNav"],"mappings":"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","file":"ems-messaging.e31bb0bc.js","sourceRoot":"..","sourcesContent":["export default class Model{\n    constructor(container){\n\n    }\n}","import Model from \"./components/model.class\"\nmapboxgl.accessToken = 'pk.eyJ1IjoiY2l0eW9mZGV0cm9pdCIsImEiOiJjajd3MGlodXIwZ3piMnhudmlzazVnNm44In0.BL29_7QRvcnOrVuXX_hD9A';\nconst map = new mapboxgl.Map({\n  container: 'map',\n  style: 'mapbox://styles/mapbox/light-v10',\n  zoom: 10.7,\n  center: [-83.060303, 42.348495]\n});\n\nfunction getUniqueFeatures(array, comparatorProperty) {\n  var existingFeatureKeys = {};\n  // Because features come from tiled vector data, feature geometries may be split\n  // or duplicated across tile boundaries and, as a result, features may appear\n  // multiple times in query results.\n  var uniqueFeatures = array.filter(function(el) {\n    if (existingFeatureKeys[el.properties[comparatorProperty]]) {\n      return false;\n    } else {\n      existingFeatureKeys[el.properties[comparatorProperty]] = true;\n      return true;\n    }\n  });\n\n  return uniqueFeatures;\n}\n\nconst nav = new mapboxgl.NavigationControl();\nmap.addControl(nav, 'bottom-right');\n\nmap.on('load', function() {\n  map.addLayer({\n    \"id\": \"zip_codes\",\n    \"type\": \"fill\",\n    \"source\": {\n      type: 'vector',\n      url: 'mapbox://cityofdetroit.7u1xneot' //city of detroit tiles\n    },\n    \"source-layer\": \"zip_codes-c4kt15\",\n    \"paint\": {\n      'fill-color': 'rgba(200, 100, 240, 0.0)',\n      'fill-outline-color': \"#ff69b4\"\n    }\n  });\n\n  map.addLayer({\n    \"id\": \"ems\",\n    \"type\": \"line\",\n    \"source\": {\n      type: 'vector',\n      url: 'mapbox://cityofdetroit.8667lu5o' // city of detroit ems alerts\n    },\n    \"source-layer\": \"Zones-4pbuzw\",\n    \"layout\": {\n      \"line-join\": \"round\",\n      \"line-cap\": \"round\"\n    },\n    \"paint\": {\n      \"line-color\": \"blue\",\n      \"line-width\": 1\n    }\n\n  });\n\n  var data1 = {\n    \"type\": \"FeatureCollection\",\n    \"features\": []\n  };\n  var feature = {\n    \"type\": \"Feature\",\n    \"properties\": {\n      \"description\": \"\",\n      \"zipcode\": \"\"\n    },\n    \"geometry\": {\n      \"type\": \"Polygon\",\n      \"coordinates\": [\n        []\n      ]\n    }\n  };\n\n  map.addSource('zipcode_fill', {\n    type: 'geojson',\n    data: data1\n  });\n  map.addLayer({\n    \"id\": \"zip_codes_fill\",\n    \"type\": \"fill\",\n    \"source\": \"zipcode_fill\",\n    \"paint\": {\n      'fill-color': 'rgba(200, 100, 240, 0.4)',\n      'fill-outline-color': 'rgba(200, 100, 240, 1)'\n    }\n  });\n\n  const popup = new mapboxgl.Popup({\n    closeButton: false,\n    closeOnClick: true\n  });\n\n  var zipcodes = {\n    \"ZIP_Code\": [\n      \"48201\",\n      \"48202\",\n      \"48203\",\n      \"48204\",\n      \"48205\",\n      \"48206\",\n      \"48207\",\n      \"48208\",\n      \"48209\",\n      \"48210\",\n      \"48211\",\n      \"48212\",\n      \"48213\",\n      \"48214\",\n      \"48215\",\n      \"48216\",\n      \"48217\",\n      \"48219\",\n      \"48221\",\n      \"48223\",\n      \"48224\",\n      \"48226\",\n      \"48227\",\n      \"48228\",\n      \"48234\",\n      \"48235\",\n      \"48236\",\n      \"48238\",\n      \"48239\",\n      \"48243\"\n    ],\n    \"DHSEM_Evacuation_Zone\": [\n      \"1\",\n      \"2\",\n      \"3\",\n      \"4\",\n      \"5\"\n    ]\n  };\nmap.on('render', function(){\n  var features = map.queryRenderedFeatures({\n    layers: ['zip_codes']\n  });\n  //console.log(features);\n  if (features) {\n    var uniqueFeatures = getUniqueFeatures(features, \"zipcode\");\n    document.getElementById(\"zipmessage\").innerHTML = '';\n    //console.log(uniqueFeatures)\n    //console.log(data.location.value);\n    var filtered = uniqueFeatures.filter(function(feature) {\n      var zipcode = feature.properties.zipcode;\n      return zipcodes.ZIP_Code.indexOf(zipcode) > -1;\n    });\n    filtered.forEach(f => {\n      var url = 'https://apis.detroitmi.gov/messenger/clients/1/locations/zipcode/' + String(f.properties.zipcode) + '/notifications/';\n      fetch(url, {\n          mode: 'cors'\n        })\n        .then(resp => resp.json()) // Transform the data into json\n        .then((data) => {\n          //console.log(data);\n          if (data.notifications.length > 0) {\n            feature.properties.zipcode = data.location.value;\n            feature.properties.description = data.notifications[0].messages[0].message;\n            feature.geometry.coordinates = f.geometry.coordinates;\n            if (data1.features.indexOf(feature) == -1) {\n              data1.features.push(feature);\n              map.getSource('zipcode_fill').setData(data1);\n              popup.setLngLat(data1.features[0].geometry.coordinates[0][0])\n                .setHTML(data1.features[0].properties.description)\n                .addTo(map);\n            }\n            document.getElementById(\"zipmessage\").innerHTML = document.getElementById(\"zipmessage\").innerHTML + '<Br/>' + 'Zipcode: ' + data.location.value + '<Br/>' + data1.features[0].properties.description;\n          }\n        })\n    })\n  }\n})\n\n\n});\n\n\n\nfunction openNav() {\n  document.getElementById(\"mySidebar\").style.width = \"450px\";\n  document.getElementById(\"main\").style.marginLeft = \"450px\";\n}\n\nfunction closeNav() {\n  document.getElementById(\"mySidebar\").style.width = \"0\";\n  document.getElementById(\"main\").style.marginLeft = \"0\";\n}"]}