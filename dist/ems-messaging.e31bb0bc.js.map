{"version":3,"sources":["index.js"],"names":["mapboxgl","accessToken","map","Map","container","style","zoom","center","getUniqueFeatures","array","comparatorProperty","existingFeatureKeys","uniqueFeatures","filter","el","properties","nav","NavigationControl","addControl","on","addLayer","type","url","data1","feature","addSource","data","geocoder","MapboxGeocoder","countries","bbox","item","context","i","id","split","shift","text","reduce","acc","cur","document","getElementById","appendChild","onAdd","popup","Popup","closeButton","closeOnClick","features","queryRenderedFeatures","layers","innerHTML","zipcodes","fetch","then","resp","json","filtered","zipcode","values","indexOf","forEach","f","String","mode","notifications","length","location","value","description","messages","message","geometry","coordinates","push","getSource","setData","setLngLat","setHTML","addTo","openNav","width","marginLeft","closeNav"],"mappings":"AACAA,QAAQ,CAACC,WAAT,GAAuB,mGAAvB;AACA,IAAMC,GAAG,GAAG,IAAIF,QAAQ,CAACG,GAAb,CAAiB;AAC3BC,EAAAA,SAAS,EAAE,KADgB;AAE3BC,EAAAA,KAAK,EAAE,kCAFoB;AAG3BC,EAAAA,IAAI,EAAE,IAHqB;AAI3BC,EAAAA,MAAM,EAAE,CAAC,CAAC,SAAF,EAAa,SAAb;AAJmB,CAAjB,CAAZ;;AAOA,SAASC,iBAAT,CAA2BC,KAA3B,EAAkCC,kBAAlC,EAAsD;AACpD,MAAIC,mBAAmB,GAAG,EAA1B,CADoD,CAEpD;AACA;AACA;;AACA,MAAIC,cAAc,GAAGH,KAAK,CAACI,MAAN,CAAa,UAASC,EAAT,EAAa;AAC7C,QAAIH,mBAAmB,CAACG,EAAE,CAACC,UAAH,CAAcL,kBAAd,CAAD,CAAvB,EAA4D;AAC1D,aAAO,KAAP;AACD,KAFD,MAEO;AACLC,MAAAA,mBAAmB,CAACG,EAAE,CAACC,UAAH,CAAcL,kBAAd,CAAD,CAAnB,GAAyD,IAAzD;AACA,aAAO,IAAP;AACD;AACF,GAPoB,CAArB;AASA,SAAOE,cAAP;AACD;;AAED,IAAMI,GAAG,GAAG,IAAIhB,QAAQ,CAACiB,iBAAb,EAAZ;AACAf,GAAG,CAACgB,UAAJ,CAAeF,GAAf,EAAoB,cAApB;AAEAd,GAAG,CAACiB,EAAJ,CAAO,MAAP,EAAe,YAAW;AACxBjB,EAAAA,GAAG,CAACkB,QAAJ,CAAa;AACX,UAAM,WADK;AAEX,YAAQ,MAFG;AAGX,cAAU;AACRC,MAAAA,IAAI,EAAE,QADE;AAERC,MAAAA,GAAG,EAAE,iCAFG,CAE+B;;AAF/B,KAHC;AAOX,oBAAgB,kBAPL;AAQX,aAAS;AACP,oBAAc,0BADP;AAEP,4BAAsB;AAFf;AARE,GAAb;AAcApB,EAAAA,GAAG,CAACkB,QAAJ,CAAa;AACX,UAAM,KADK;AAEX,YAAQ,MAFG;AAGX,cAAU;AACRC,MAAAA,IAAI,EAAE,QADE;AAERC,MAAAA,GAAG,EAAE,iCAFG,CAE+B;;AAF/B,KAHC;AAOX,oBAAgB,cAPL;AAQX,cAAU;AACR,mBAAa,OADL;AAER,kBAAY;AAFJ,KARC;AAYX,aAAS;AACP,oBAAc,MADP;AAEP,oBAAc;AAFP;AAZE,GAAb;AAmBA,MAAIC,KAAK,GAAG;AACV,YAAQ,mBADE;AAEV,gBAAY;AAFF,GAAZ;AAIA,MAAIC,OAAO,GAAG;AACZ,YAAQ,SADI;AAEZ,kBAAc;AACZ,qBAAe,EADH;AAEZ,iBAAW;AAFC,KAFF;AAMZ,gBAAY;AACV,cAAQ,SADE;AAEV,qBAAe,CACb,EADa;AAFL;AANA,GAAd;AAcAtB,EAAAA,GAAG,CAACuB,SAAJ,CAAc,cAAd,EAA8B;AAC5BJ,IAAAA,IAAI,EAAE,SADsB;AAE5BK,IAAAA,IAAI,EAAEH;AAFsB,GAA9B;AAIArB,EAAAA,GAAG,CAACkB,QAAJ,CAAa;AACX,UAAM,gBADK;AAEX,YAAQ,MAFG;AAGX,cAAU,cAHC;AAIX,aAAS;AACP,oBAAc,0BADP;AAEP,4BAAsB;AAFf;AAJE,GAAb,EAxDwB,CAkExB;;AACA,MAAIO,QAAQ,GAAG,IAAIC,cAAJ,CAAmB;AAChC3B,IAAAA,WAAW,EAAED,QAAQ,CAACC,WADU;AAGhC;AACA4B,IAAAA,SAAS,EAAE,IAJqB;AAMhC;AACA;AACAC,IAAAA,IAAI,EAAE,CAAC,CAAC,OAAF,EAAU,OAAV,EAAkB,CAAC,OAAnB,EAA2B,OAA3B,CAR0B;AAUhC;AACA;AACAjB,IAAAA,MAAM,EAAE,gBAAUkB,IAAV,EAAgB;AACxB;AACA,aAAOA,IAAI,CAACC,OAAL,CAAa9B,GAAb,CAAiB,UAAU+B,CAAV,EAAa;AACrC;AACA;AACA,eAAQA,CAAC,CAACC,EAAF,CAAKC,KAAL,CAAW,GAAX,EAAgBC,KAAhB,OAA4B,QAA5B,IAAwCH,CAAC,CAACI,IAAF,KAAW,UAA3D;AACC,OAJM,EAIJC,MAJI,CAIG,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC9B,eAAOD,GAAG,IAAIC,GAAd;AACC,OANM,CAAP;AAOC,KArB+B;AAsBhCxC,IAAAA,QAAQ,EAAEA;AAtBsB,GAAnB,CAAf;AAwBEyC,EAAAA,QAAQ,CAACC,cAAT,CAAwB,UAAxB,EAAoCC,WAApC,CAAgDhB,QAAQ,CAACiB,KAAT,CAAe1C,GAAf,CAAhD,EA3FsB,CA8FtB;;AACF,MAAM2C,KAAK,GAAG,IAAI7C,QAAQ,CAAC8C,KAAb,CAAmB;AAC/BC,IAAAA,WAAW,EAAE,KADkB;AAE/BC,IAAAA,YAAY,EAAE;AAFiB,GAAnB,CAAd,CA/FwB,CAmG1B;AACA;;AACE9C,EAAAA,GAAG,CAACiB,EAAJ,CAAO,QAAP,EAAgB,WAAhB,EAA8B,YAAW;AACvC,QAAI8B,QAAQ,GAAG/C,GAAG,CAACgD,qBAAJ,CAA0B;AACvCC,MAAAA,MAAM,EAAE,CAAC,WAAD;AAD+B,KAA1B,CAAf,CADuC,CAIvC;;AACA,QAAIF,QAAJ,EAAc;AACZ,UAAIrC,cAAc,GAAGJ,iBAAiB,CAACyC,QAAD,EAAW,SAAX,CAAtC;AACAR,MAAAA,QAAQ,CAACC,cAAT,CAAwB,YAAxB,EAAsCU,SAAtC,GAAkD,EAAlD,CAFY,CAGZ;AACA;;AACA,UAAIC,QAAQ,GAAG,IAAf,CALY,CAMf;;AACGC,MAAAA,KAAK,CAAC,iDAAD,CAAL,CAAyDC,IAAzD,CAA8D,UAAAC,IAAI;AAAA,eAAIA,IAAI,CAACC,IAAL,EAAJ;AAAA,OAAlE,EAAmFF,IAAnF,CAAwF,UAAC7B,IAAD,EAAS;AAC/F;AACA2B,QAAAA,QAAQ,GAAG3B,IAAX,CAF+F,CAG/F;;AACA,YAAIgC,QAAQ,GAAG9C,cAAc,CAACC,MAAf,CAAsB,UAASW,OAAT,EAAkB;AACrD,cAAImC,OAAO,GAAGnC,OAAO,CAACT,UAAR,CAAmB4C,OAAjC;AACA,iBAAON,QAAQ,CAACM,OAAT,CAAiBC,MAAjB,CAAwBC,OAAxB,CAAgCF,OAAhC,IAA2C,CAAC,CAAnD;AACD,SAHc,CAAf;AAIAD,QAAAA,QAAQ,CAACI,OAAT,CAAiB,UAAAC,CAAC,EAAI;AACpB,cAAIzC,GAAG,GAAG,sEAAsE0C,MAAM,CAACD,CAAC,CAAChD,UAAF,CAAa4C,OAAd,CAA5E,GAAqG,iBAA/G;AACAL,UAAAA,KAAK,CAAChC,GAAD,EAAM;AACP2C,YAAAA,IAAI,EAAE;AADC,WAAN,CAAL,CAGGV,IAHH,CAGQ,UAAAC,IAAI;AAAA,mBAAIA,IAAI,CAACC,IAAL,EAAJ;AAAA,WAHZ,EAG6B;AAH7B,WAIGF,IAJH,CAIQ,UAAC7B,IAAD,EAAU;AACd;AACA,gBAAIA,IAAI,CAACwC,aAAL,CAAmBC,MAAnB,GAA4B,CAAhC,EAAmC;AACjC3C,cAAAA,OAAO,CAACT,UAAR,CAAmB4C,OAAnB,GAA6BjC,IAAI,CAAC0C,QAAL,CAAcC,KAA3C;AACA7C,cAAAA,OAAO,CAACT,UAAR,CAAmBuD,WAAnB,GAAiC5C,IAAI,CAACwC,aAAL,CAAmB,CAAnB,EAAsBK,QAAtB,CAA+B,CAA/B,EAAkCC,OAAnE;AACAhD,cAAAA,OAAO,CAACiD,QAAR,CAAiBC,WAAjB,GAA+BX,CAAC,CAACU,QAAF,CAAWC,WAA1C;;AACA,kBAAInD,KAAK,CAAC0B,QAAN,CAAeY,OAAf,CAAuBrC,OAAvB,KAAmC,CAAC,CAAxC,EAA2C;AACzCD,gBAAAA,KAAK,CAAC0B,QAAN,CAAe0B,IAAf,CAAoBnD,OAApB;AACAtB,gBAAAA,GAAG,CAAC0E,SAAJ,CAAc,cAAd,EAA8BC,OAA9B,CAAsCtD,KAAtC;AAED;AACF;AACF,WAhBH;AAiBD,SAnBD;AAoBD,OA5BD;AA6BDA,MAAAA,KAAK,CAAC0B,QAAN,CAAea,OAAf,CAAuB,UAAAC,CAAC,EAAI;AAC3BlB,QAAAA,KAAK,CAACiC,SAAN,CAAgBf,CAAC,CAACU,QAAF,CAAWC,WAAX,CAAuB,CAAvB,EAA0B,CAA1B,CAAhB,EACGK,OADH,CACWhB,CAAC,CAAChD,UAAF,CAAauD,WADxB,EAEGU,KAFH,CAES9E,GAFT;AAGAuC,QAAAA,QAAQ,CAACC,cAAT,CAAwB,YAAxB,EAAsCU,SAAtC,GAAkDX,QAAQ,CAACC,cAAT,CAAwB,YAAxB,EAAsCU,SAAtC,GAAkD,OAAlD,GAA4D,WAA5D,GAA0EW,CAAC,CAAChD,UAAF,CAAa4C,OAAvF,GAAiG,OAAjG,GAA2GI,CAAC,CAAChD,UAAF,CAAauD,WAA1K;AACD,OALA;AAMA;AACF,GAhDD;AAiDD,CAtJD;;AA0JA,SAASW,OAAT,GAAmB;AACjBxC,EAAAA,QAAQ,CAACC,cAAT,CAAwB,WAAxB,EAAqCrC,KAArC,CAA2C6E,KAA3C,GAAmD,OAAnD;AACAzC,EAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgCrC,KAAhC,CAAsC8E,UAAtC,GAAmD,OAAnD;AACD;;AAED,SAASC,QAAT,GAAoB;AAClB3C,EAAAA,QAAQ,CAACC,cAAT,CAAwB,WAAxB,EAAqCrC,KAArC,CAA2C6E,KAA3C,GAAmD,GAAnD;AACAzC,EAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgCrC,KAAhC,CAAsC8E,UAAtC,GAAmD,GAAnD;AACD","file":"ems-messaging.e31bb0bc.js","sourceRoot":"..","sourcesContent":["\nmapboxgl.accessToken = 'pk.eyJ1IjoiY2l0eW9mZGV0cm9pdCIsImEiOiJjajd3MGlodXIwZ3piMnhudmlzazVnNm44In0.BL29_7QRvcnOrVuXX_hD9A';\nconst map = new mapboxgl.Map({\n  container: 'map',\n  style: 'mapbox://styles/mapbox/light-v10',\n  zoom: 10.7,\n  center: [-83.060303, 42.348495]\n});\n\nfunction getUniqueFeatures(array, comparatorProperty) {\n  var existingFeatureKeys = {};\n  // Because features come from tiled vector data, feature geometries may be split\n  // or duplicated across tile boundaries and, as a result, features may appear\n  // multiple times in query results.\n  var uniqueFeatures = array.filter(function(el) {\n    if (existingFeatureKeys[el.properties[comparatorProperty]]) {\n      return false;\n    } else {\n      existingFeatureKeys[el.properties[comparatorProperty]] = true;\n      return true;\n    }\n  });\n\n  return uniqueFeatures;\n}\n\nconst nav = new mapboxgl.NavigationControl();\nmap.addControl(nav, 'bottom-right');\n\nmap.on('load', function() {\n  map.addLayer({\n    \"id\": \"zip_codes\",\n    \"type\": \"fill\",\n    \"source\": {\n      type: 'vector',\n      url: 'mapbox://cityofdetroit.7u1xneot' //city of detroit tiles\n    },\n    \"source-layer\": \"zip_codes-c4kt15\",\n    \"paint\": {\n      'fill-color': 'rgba(200, 100, 240, 0.0)',\n      'fill-outline-color': \"#ff69b4\"\n    }\n  });\n\n  map.addLayer({\n    \"id\": \"ems\",\n    \"type\": \"line\",\n    \"source\": {\n      type: 'vector',\n      url: 'mapbox://cityofdetroit.8667lu5o' // city of detroit ems alerts\n    },\n    \"source-layer\": \"Zones-4pbuzw\",\n    \"layout\": {\n      \"line-join\": \"round\",\n      \"line-cap\": \"round\"\n    },\n    \"paint\": {\n      \"line-color\": \"blue\",\n      \"line-width\": 1\n    }\n\n  });\n\n  var data1 = {\n    \"type\": \"FeatureCollection\",\n    \"features\": []\n  };\n  var feature = {\n    \"type\": \"Feature\",\n    \"properties\": {\n      \"description\": \"\",\n      \"zipcode\": \"\"\n    },\n    \"geometry\": {\n      \"type\": \"Polygon\",\n      \"coordinates\": [\n        []\n      ]\n    }\n  };\n\n  map.addSource('zipcode_fill', {\n    type: 'geojson',\n    data: data1\n  });\n  map.addLayer({\n    \"id\": \"zip_codes_fill\",\n    \"type\": \"fill\",\n    \"source\": \"zipcode_fill\",\n    \"paint\": {\n      'fill-color': 'rgba(200, 100, 240, 0.4)',\n      'fill-outline-color': 'rgba(200, 100, 240, 1)'\n    }\n  });\n  \n  // geocoder for address search\n  var geocoder = new MapboxGeocoder({\n    accessToken: mapboxgl.accessToken,\n     \n    // limit results to North America\n    countries: 'us',\n     \n    // further limit results to the geographic bounds representing the region of\n    // Detroit Michigan\n    bbox: [-83.3437,42.2102,-82.8754,42.5197],\n     \n    // apply a client side filter to further limit results to those strictly within\n    // the New South Wales region\n    filter: function (item) {\n    // returns true if item contains New South Wales region\n    return item.context.map(function (i) {\n    // id is in the form {index}.{id} per https://github.com/mapbox/carmen/blob/master/carmen-geojson.md\n    // this example attempts to find the `region` named `Detroit Michigan`\n    return (i.id.split('.').shift() === 'region' && i.text === 'Michigan');\n    }).reduce(function (acc, cur) {\n    return acc || cur;\n    });\n    },\n    mapboxgl: mapboxgl\n    });\n    document.getElementById('geocoder').appendChild(geocoder.onAdd(map));\n    \n     \n    // document.getElementById('geocoder').appendChild(geocoder.onAdd(map));\n  const popup = new mapboxgl.Popup({\n    closeButton: false,\n    closeOnClick: true\n  });\n// geocoder ends \n// Add API data to populate the map\n  map.on('render',\"zip_codes\" , function() {\n    var features = map.queryRenderedFeatures({\n      layers: ['zip_codes']\n    });\n    //console.log(features);\n    if (features) {\n      var uniqueFeatures = getUniqueFeatures(features, \"zipcode\");\n      document.getElementById(\"zipmessage\").innerHTML = '';\n      //console.log(uniqueFeatures)\n      //console.log(data.location.value);\n      var zipcodes = null;\n   // location APi contains of list of zipcode and ems zones\n      fetch('https://apis.detroitmi.gov/messenger/locations/').then(resp => resp.json()).then((data)=> {\n        //console.log(data);\n        zipcodes = data;\n        //console.log(zipcodes)\n        var filtered = uniqueFeatures.filter(function(feature) {\n          var zipcode = feature.properties.zipcode;\n          return zipcodes.zipcode.values.indexOf(zipcode) > -1;\n        });\n        filtered.forEach(f => {\n          var url = 'https://apis.detroitmi.gov/messenger/clients/1/locations/zipcode/' + String(f.properties.zipcode) + '/notifications/';\n          fetch(url, {\n              mode: 'cors'\n            })\n            .then(resp => resp.json()) // Transform the data into json\n            .then((data) => {\n              //console.log(data);\n              if (data.notifications.length > 0) {\n                feature.properties.zipcode = data.location.value;\n                feature.properties.description = data.notifications[0].messages[0].message;\n                feature.geometry.coordinates = f.geometry.coordinates;\n                if (data1.features.indexOf(feature) == -1) {\n                  data1.features.push(feature);\n                  map.getSource('zipcode_fill').setData(data1);\n\n                }\n              }\n            })\n        })\n      })\n     data1.features.forEach(f => {\n      popup.setLngLat(f.geometry.coordinates[0][0])\n        .setHTML(f.properties.description)\n        .addTo(map);\n      document.getElementById(\"zipmessage\").innerHTML = document.getElementById(\"zipmessage\").innerHTML + '<Br/>' + 'Zipcode: ' + f.properties.zipcode + '<Br/>' + f.properties.description;\n    })\n    }\n  })\n});\n\n\n\nfunction openNav() {\n  document.getElementById(\"mySidebar\").style.width = \"450px\";\n  document.getElementById(\"main\").style.marginLeft = \"450px\";\n}\n\nfunction closeNav() {\n  document.getElementById(\"mySidebar\").style.width = \"0\";\n  document.getElementById(\"main\").style.marginLeft = \"0\";\n}"]}