{"version":3,"sources":["components/model.class.js","index.js"],"names":["Model","container","mapboxgl","accessToken","map","Map","style","zoom","center","getUniqueFeatures","array","comparatorProperty","existingFeatureKeys","uniqueFeatures","filter","el","properties","nav","NavigationControl","addControl","on","addLayer","type","url","data1","feature","addSource","data","popup","Popup","closeButton","closeOnClick","getCanvas","cursor","features","queryRenderedFeatures","layers","document","getElementById","innerHTML","forEach","f","String","zipcode","fetch","mode","then","resp","json","console","log","location","value","description","notifications","messages","message","geometry","coordinates","push","getSource","setData","setLngLat","setHTML","addTo","openNav","width","marginLeft","closeNav"],"mappings":"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","file":"ems-messaging.e31bb0bc.js","sourceRoot":"..","sourcesContent":["export default class Model{\n    constructor(container){\n\n    }\n}","import Model from \"./components/model.class\"\nmapboxgl.accessToken = 'pk.eyJ1IjoiY2l0eW9mZGV0cm9pdCIsImEiOiJjajd3MGlodXIwZ3piMnhudmlzazVnNm44In0.BL29_7QRvcnOrVuXX_hD9A';\nconst map = new mapboxgl.Map({\n    container: 'map',\n    style: 'mapbox://styles/mapbox/light-v10',\n    zoom: 10.7,\n    center: [-83.060303,42.348495]\n});\n\nfunction getUniqueFeatures(array, comparatorProperty) {\n    var existingFeatureKeys = {};\n    // Because features come from tiled vector data, feature geometries may be split\n    // or duplicated across tile boundaries and, as a result, features may appear\n    // multiple times in query results.\n    var uniqueFeatures = array.filter(function(el) {\n    if (existingFeatureKeys[el.properties[comparatorProperty]]) {\n    return false;\n    } else {\n    existingFeatureKeys[el.properties[comparatorProperty]] = true;\n    return true;\n    }\n    });\n\n    return uniqueFeatures;\n}\n\nconst nav = new mapboxgl.NavigationControl();\nmap.addControl(nav, 'bottom-right');\n\nmap.on('load', function () {\n    map.addLayer({\n        \"id\": \"zip_codes\",\n        \"type\": \"fill\",\n        \"source\": {\n            type: 'vector',\n            url: 'mapbox://cityofdetroit.7u1xneot' //city of detroit tiles\n        },\n        \"source-layer\": \"zip_codes-c4kt15\",\n        \"paint\": {\n          'fill-color': 'rgba(200, 100, 240, 0.0)',\n          'fill-outline-color': \"#ff69b4\"\n        }\n    });\n\n    map.addLayer({\n        \"id\": \"ems\",\n        \"type\": \"line\",\n        \"source\": {\n            type: 'vector',\n            url: 'mapbox://cityofdetroit.8667lu5o' // city of detroit ems alerts\n        },\n        \"source-layer\": \"Zones-4pbuzw\",\n        \"layout\": {\n            \"line-join\": \"round\",\n            \"line-cap\": \"round\"\n        },\n        \"paint\": {\n            \"line-color\": \"blue\",\n            \"line-width\": 1\n        }\n\n    });\n  var  data1 = { \"type\": \"FeatureCollection\",\n                      \"features\": []\n                  };\n var feature = {\n   \"type\": \"Feature\",\n   \"properties\": {\n   \"description\": \"\",\n   \"zipcode\": \"\"\n },\n \"geometry\":{\n   \"type\": \"Polygon\",\n   \"coordinates\":[[]]\n }\n};\n    map.addSource('zipcode_fill', { type: 'geojson', data: data1 });\n    map.addLayer({\n                    \"id\": \"zip_codes_fill\",\n                    \"type\": \"fill\",\n                    \"source\": \"zipcode_fill\",\n                    \"paint\": {\n                            'fill-color': 'rgba(200, 100, 240, 0.4)',\n                            'fill-outline-color': 'rgba(200, 100, 240, 1)'\n                          }\n    });\n\n\n    const popup = new mapboxgl.Popup({\n       closeButton: false,\n       closeOnClick: true\n    });\n\n    map.on('mouseenter', 'zip_codes', function () {\n    map.getCanvas().style.cursor = 'pointer';\n\n    var features = map.queryRenderedFeatures({ layers: ['zip_codes'] });\n    //console.log(features);\n    if (features) {\n      var uniqueFeatures = getUniqueFeatures(features, \"zipcode\");\n      document.getElementById(\"zipmessage\").innerHTML = '';\n      //console.log(uniqueFeatures)\n      //console.log(data.location.value);\n      uniqueFeatures.forEach(f => {\n        var url = 'https://apis.detroitmi.gov/messenger/clients/1/locations/'+ String(f.properties.zipcode)+'/notifications/';\n        fetch(url, { mode: 'cors' })\n          .then(resp => resp.json()) // Transform the data into json\n          .then((data) => {\n             console.log(data);\n             if(data.location.value)\n                 {\n                  //console.log(f)\n                  //console.log(data1)\n                  //console.log(data.notifications)\n                 feature.properties.zipcode = data.location.value;\n                 feature.properties.description = data.notifications[0].messages[0].message;\n                 feature.geometry.coordinates = f.geometry.coordinates;\n\n                 data1.features.push(feature);\n                 //console.log(f.geometry.coordinates[0][0]);\n                 map.getSource('zipcode_fill').setData(data1);\n                 popup.setLngLat(data1.features[0].geometry.coordinates[0][0])\n                     .setHTML(data1.features[0].properties.description)\n                     .addTo(map);\n\n                document.getElementById(\"zipmessage\").innerHTML = document.getElementById(\"zipmessage\").innerHTML + '<Br/>' + 'Zipcode: '+data.location.value +'<Br/>'+data1.features[0].properties.description;\n               }\n          });\n\n\n      })\n    }\n\n    });\n\n    // Change it back to a pointer when it leaves.\n    map.on('mouseleave', 'zip_codes', function () {\n    map.getCanvas().style.cursor = '';\n    });\n\n\n});\n\nfunction openNav() {\n    document.getElementById(\"mySidebar\").style.width = \"450px\";\n    document.getElementById(\"main\").style.marginLeft = \"450px\";\n}\n\nfunction closeNav() {\n    document.getElementById(\"mySidebar\").style.width = \"0\";\n    document.getElementById(\"main\").style.marginLeft= \"0\";\n}"]}